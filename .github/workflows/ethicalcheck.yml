name: EthicalCheck – Analyse API et création produit

on:
  push:
    branches:
      - main

jobs:
  ethicalcheck:
    runs-on: ubuntu-latest
    steps:
      - name: Vérification Git
        run: |
          git status || echo "Git non initialisé"
          git config --list || echo "Pas de config Git"

      - name: ✅ Checkout du dépôt
        uses: actions/checkout@v4

      - name: 📡 Appel à l'API EthicalCheck
        run: |
          curl -X POST https://ethicalcheck.dev/api/check \
          -H "Content-Type: application/json" \
          -d '{"url": "https://blackbird-mhwe.onrender.com/api/customers/request-data"}'


      - name: 🛠️ Création du produit
        run: node createProduct.js

      - name: 📄 Génération du rapport SARIF
        run: |
          echo '{
            "version": "2.1.0",
            "runs": []
          }' > ethicalcheck.sarif.json

      - name: 📤 Upload du rapport SARIF
        uses: github/codeql-action/upload-sarif@v3
        with:
          sarif_file: ethicalcheck.sarif.json

{
  "version": "2.1.0",
  "runs": [
    {
      "results": [
        {
          "ruleId": "ethical-check-001",
          "message": { "text": "Produit conforme aux critères éthiques." },
          "locations": [...]
        }
      ]
    }
  ]
}






