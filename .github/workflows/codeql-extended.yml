name: CodeQL Extended

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  analyze:
    name: Analyze Matrix
    runs-on: ubuntu-latest
    permissions:
      actions: read
      contents: read
      security-events: write

    strategy:
      fail-fast: false
      matrix:
        include:
          - language: javascript-typescript
            build-mode: none
          - language: python
            build-mode: none

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Initialize CodeQL
        uses: github/codeql-action/init@v3
        with:
          languages: ${{ matrix.language }}
          build-mode: ${{ matrix.build-mode }}

      - name: Analyze
        uses: github/codeql-action/analyze@v3
                    
  # You may pin to the exact commit or the version.
  # uses: stackql/stackql-deploy-action@d901f6ccfa4b21de69d35f42032287d26ace01d5
  uses: stackql/stackql-deploy-action@v1.0.2
  with:
    # stackql-deploy command to run (`build` or `test`)
    command: 
    # repo directory containing `stackql_manifest.yml` and `resources` dir
    stack_dir: 
    # environment to deploy or test (e.g., `dev`, `prod`)
    stack_env: 
    # environment variables or secrets imported into a stack (format: `KEY=value,KEY2=value2`)
    env_vars: # optional
    # environment variables sourced from a file
    env_file: # optional
    # show queries run in the output logs
    show_queries: # optional
    # set the logging level (`INFO` or `DEBUG`, defaults to `INFO`)
    log_level: # optional
    # perform a dry run of the operation
    dry_run: # optional
    # custom registry URL to be used for stackql
    custom_registry: # optional
    # action on failure
    on_failure: # optional
          
